<?xml version="1.0"?>
<openerp>
    <data>
        <record model="ir.ui.view" id="view_purchase_order_line_tree">
            <field name="name">purchase.order.line.tree</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <tree string="Purchase line" >
                     <field name="order_id" />
                     <field name="product_id" />
                     <field name="name" />
                     <field name="product_qty" />
                     <field name="date_planned" />
                     
                     <!--Total: -->
                     <field name="logistic_delivered_qty" />
                     <field name="logistic_undelivered_qty" />

                     <!--Sale reference:-->
                     <field name="logistic_sale_id" />
                     <field name="load_line_ids" />                     
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_purchase_order_line_form">
            <field name="name">purchase.order.line.form</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <form string="Purchase line">
                    <sheet>
                        <group colspan="4" col="4">
                             <field name="order_id" />
                             <newline/>
                             <field name="product_id" />
                             <field name="name" />
                             
                             <field name="product_qty" />
                             <field name="date_planned" />
                             
                             <!--Total: -->
                             <field name="logistic_delivered_qty" />
                             <field name="logistic_undelivered_qty" />

                             <!--Sale reference:-->
                             <field name="logistic_sale_id" />
                             <separator string="Stock move loads:" colspan="4"/>
                             <field name="load_line_ids" colspan="4" nolabel="1"/>
                        </group>     
                    </sheet>
                </form>
            </field>
        </record>
        
        <!--PURCHASE STOCK MANAGEMENT:-->
        <record model="ir.ui.view" id="view_delivery_selection_tree">
            <field name="name">purchase.order.line.tree</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <tree string="Purchase line" default_order="create_date,product_id" editable="bottom" create="false" decoration-success="delivery_id!=False">
                     <field name="order_id" readonly="1"/>
                     <button name="open_detail_delivery_in" string="Open detail for line" type="object" icon="fa-list-alt"/>
                     <field name="product_id" readonly="1" />
                     <!--<field name="name" readonly="1" />-->
                     <field name="product_qty" readonly="1" />
                     <field name="date_planned" readonly="1" />
                     
                     <field name="order_supplier_id" readonly="1" />
                     <field name="carrier_id" readonly="1" />

                     <field name="raggio" readonly="1" />
                     <field name="larghezza" readonly="1" />
                     <field name="spalla" readonly="1" />

                     <!--Total: -->
                     <field name="logistic_delivered_qty" readonly="1" />
                     <field name="logistic_undelivered_qty" readonly="1" />
                     
                     <button name="delivery_0" string="0" type="object" icon="fa-bitbucket"/>
                     <button name="delivery_less_1" string="-" type="object" icon="fa-minus-circle"/>
                     <button name="delivery_more_1" string="+" type="object" icon="fa-plus-circle"/>
                     <button name="delivery_all" string="Remain" type="object" icon="fa-fast-forward"/>
                     
                     <field name="logistic_delivered_manual" />
                     <field name="delivery_id" invisible="1"/>
                </tree>
            </field>
        </record>
        <!--TODO -->
        <record model="ir.ui.view" id="view_delivery_selection_form">
            <field name="name">purchase.order.line.form</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <form string="Purchase line">
                    <header>
                    </header>
                    
                    <sheet>
                        <group colspan="4" col="4" >
                             <field name="order_id" readonly="1"/>
                             <field name="logistic_sale_id" readonly="1"/>

                             <field name="order_supplier_id" readonly="1"/>
                             <field name="carrier_id" readonly="1"/>                             
                             
                             <field name="product_id" readonly="1"/>
                             <field name="name" readonly="1"/>
                             
                             <field name="product_qty" readonly="1"/>
                             <notebook colspan="4">
                                 <page string="Tyres">
                                     <group colspan="4" col="4">
                                         <field name="raggio" readonly="1"/>
                                         <field name="larghezza" readonly="1"/>
                                         <field name="spalla" readonly="1"/>
                                     </group>    
                                 </page>
                                 <page string="Delivery">
                                     <group colspan="4" col="4">
                                         <field name="date_planned" readonly="1"/>
                                         <!--Total: -->
                                         <field name="logistic_delivered_qty" readonly="1"/>
                                         <field name="logistic_undelivered_qty" readonly="1" />
                                     </group>    
                                 </page>
                             </notebook>
                        </group>     
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.ui.view" id="view_delivery_selection_search">
            <field name="name">purchase.order.line.search</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40"/>
            <field name="arch" type="xml">
                <search string="Purchase line">
                    <field name="name" />
                    <field name="product_id" filter_domain="[('product_id','=',self)]"/>
                    <field name="order_id" filter_domain="[('order_id','=',self)]"/>
                    
                    <field name="carrier_id" />
                    <field name="order_supplier_id" />

                    <field name="raggio" />
                    <field name="larghezza" />
                    <field name="spalla" />

                    <filter name="my_selection" string="Current selected" domain="[('delivery_id','=',False), ('user_select_id', '=', uid)]"/>

                    <!--<filter name="state_draft" string="Draft state" domain="[('state','=','draft')]"/>-->
                    <group expand="0" string="Group By...">
                    
                        <filter name="group_raggio" string="Ray" context="{'group_by': 'raggio'}"/>
                        <filter name="group_larghezza" string="Width" context="{'group_by': 'larghezza'}"/>
                        <filter name="group_spalla" string="Shoulder" context="{'group_by': 'spalla'}"/>

                        <filter name="group_purchase" string="Purchase order" context="{'group_by': 'order_id'}"/>
                        <filter name="group_product" string="Product" context="{'group_by': 'product_id'}"/>
                        <!--<filter string="Status" context="{'group_by': 'state'}" />-->
                    </group>                
                </search>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_purchase_selection_order_line">
            <field name="name">Delivery PO pending</field>
            <field name="res_model">purchase.order.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_delivery_selection_tree"/>
            <field name="search_view_id" ref="view_delivery_selection_search"/>            
            <!--<field name="context">{'form_view_ref': 'logistic_pick_in_load.view_delivery_selection_form'}</field>-->
            <field name="domain">[('delivery_id', '=', False), ('order_id.logistic_state', '=', 'confirmed')]</field>
        </record>


        <record model="ir.actions.act_window" id="action_purchase_order_line">
            <field name="name">Purchase line</field>
            <field name="res_model">purchase.order.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_purchase_order_line_tree"/>
            <field name="context">{'form_view_ref': 'logistic_pick_in_load.view_purchase_order_line_form'}</field>
            <field name="domain">[]</field>
        </record>
        
        <!--stock.picking.delivery-->
        <record model="ir.ui.view" id="view_stock_picking_delivery_tree">
            <field name="name">stock.picking.delivery.tree</field>
            <field name="model">stock.picking.delivery</field>
            <field name="arch" type="xml">
                <tree string="Delivery" decoration-primary="picking_id==False">
                    <field name="create_date" />
                    <field name="create_uid" />
                    <field name="supplier_id" />
                    <field name="carrier_id" />
                    <field name="picking_id" />
                    <!--<field name="purchase_line_ids" />-->
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_stock_picking_delivery_form">
            <field name="name">stock.picking.delivery.form</field>
            <field name="model">stock.picking.delivery</field>
            <field name="arch" type="xml">
                <form string="Delivery">
                    <header>
                        <button name="confirm_stock_load" string="Load stock" type="object" attrs="{'invisible': [('picking_id','!=',False)]}" class="oe_highlight" confirm="Confirm load operation?"/>
                    </header>
                    <sheet>
                        <group colspan="4" col="4"> 
                            <field name="name" />
                            <field name="picking_id" attrs="{'invisible': [('picking_id','=',False)]}" readonly="1"/>
                            

                            <field name="supplier_id" />
                            <field name="carrier_id" />
                            
                            <field name="create_date" readonly="1"/>
                            <field name="create_uid" readonly="1"/>
                            
                            <notebook colspan="4">
                                <page string="Selected purchase line:" attrs="{'invisible': [('picking_id','!=',False)]}">
                                    <group colspan="4" col="4"> 
                                        <separator string="Selected purchase line:" colspan="3"/>
                                        <button name="open_purchase_line" string="Open line" type="object" class="oe_highlight" colspan="1" icon="fa-align-justify"/>
                                        <field name="purchase_line_ids" colspan="4" nolabel="1">
                                            <tree string="Purchase line" editable="bottom" create="false" delete="false">
                                                 <field name="order_id" readonly="1"/>
                                                 <field name="product_id" readonly="1" />
                                                 <!--<field name="name" readonly="1" />-->
                                                 <field name="product_qty" readonly="1" />
                                                 <field name="date_planned" readonly="1" />
                                                 
                                                 <!--Total: -->
                                                 <field name="logistic_delivered_qty" readonly="1" />
                                                 <field name="logistic_undelivered_qty" readonly="1" />
                                                 
                                                 <!--<button name="delivery_0" string="0" type="object" icon="fa-bitbucket"/>
                                                 <button name="delivery_less_1" string="-" type="object" icon="fa-minus-circle"/>
                                                 <button name="delivery_more_1" string="+" type="object" icon="fa-plus-circle"/>
                                                 <button name="delivery_all" string="Remain" type="object" icon="fa-fast-forward"/>-->
                                                 
                                                 <field name="logistic_delivered_manual" readonly="1"/>

                                                 <!--Sale reference:
                                                 <field name="logistic_sale_id" />
                                                 <field name="load_line_ids" />-->
                                            </tree>
                                        </field>
                                    </group>    
                                </page>
                                <page string="Stock movement:" attrs="{'invisible': [('picking_id','=',False)]}">
                                    <group colspan="4" col="4"> 
                                        <separator string="Stock movement:" colspan="4"/>
                                        <field name="move_ids" colspan="4" nolabel="1">
                                        </field>
                                    </group>    
                                </page>
                                <page string="Extra stock:">
                                    <group colspan="4" col="4"> 
                                        <separator string="Account extra stock:" colspan="4"/>
                                        <field name="quant_ids" colspan="4" nolabel="1">
                                            <tree string="Stock quant:" editable="bottom" decoration-success="account_sync==True">
                                                <field name="product_id" />
                                                <field name="product_qty" />
                                                <field name="price" />                                                
                                                <field name="account_sync" invisible="1"/>
                                            </tree>
                                        </field>
                                    </group>    
                                </page>
                            </notebook> 

                        </group>    
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_my_stock_picking_delivery_tree">
            <field name="name">My delivery pending</field>
            <field name="res_model">stock.picking.delivery</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_stock_picking_delivery_tree"/>
            <field name="context">{}</field>
            <field name="domain">[('create_uid', '=', uid), ('picking_id', '=', False)]</field>
        </record>
        <record model="ir.actions.act_window" id="action_stock_picking_delivery_tree">
            <field name="name">All delivery</field>
            <field name="res_model">stock.picking.delivery</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_stock_picking_delivery_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>
        <record model="ir.actions.act_window" id="action_stock_picking_delivery_form">
            <field name="name">New Delivery</field>
            <field name="res_model">stock.picking.delivery</field>
            <field name="view_type">form</field>
            <field name="view_mode">form,tree</field>
            <field name="view_id" ref="view_stock_picking_delivery_form"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>
        
        <menuitem 
             id="menu_purchase_order_line" 
             parent="tyres_logistic_management.menu_logistic_management_root"
             action="action_purchase_order_line"
             sequence="30"
             />

        <menuitem
             id="menu_logistic_delivery_management_root" 
             parent="tyres_logistic_management.menu_logistic_header_root"
             name="Manage supplier delivery"
             sequence="29"
             />
             
             <menuitem 
                 parent="menu_logistic_delivery_management_root" 
                 id="menu_purchase_selection_order_line" 
                 action="action_purchase_selection_order_line"
                 sequence="5"
                 />
             <menuitem 
                 parent="menu_logistic_delivery_management_root" 
                 id="menu_stock_picking_delivery_form" 
                 action="action_stock_picking_delivery_form"
                 sequence="10"
                 />
             <menuitem 
                 parent="menu_logistic_delivery_management_root" 
                 id="menu_my_stock_picking_delivery_tree" 
                 action="action_my_stock_picking_delivery_tree"
                 sequence="20"
                 />
             <menuitem 
                 parent="menu_logistic_delivery_management_root" 
                 id="menu_stock_picking_delivery_tree" 
                 action="action_stock_picking_delivery_tree"
                 sequence="30"
                 />
             
             
             
    </data>
</openerp>
